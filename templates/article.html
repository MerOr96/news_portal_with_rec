{% extends 'base.html' %}
{% block title %}{{ article.get('title','–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è') }} - News Portal{% endblock %}
{% block content %}
  <article class="article">
    <h2>{{ article.get('title','–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è') }}</h2>
    
    <div class="meta">
      {% if article.get('topic') %}
      <a href="{{ url_for('by_topic', topic=article['topic']) }}" class="tag">
        {{ article['topic'] }}
      </a>
      {% endif %}
      {% if article.get('date') %}
      <span class="date">üìÖ {{ article['date'] }}</span>
      {% endif %}
      {% if article.get('text') %}
      <span class="reading-time">‚è±Ô∏è {{ ((article['text']|length / 200)|round(1))|int }} –º–∏–Ω —á—Ç–µ–Ω–∏—è</span>
      {% endif %}
      {% if article.get('url') %}
      <a href="{{ article['url'] }}" target="_blank" rel="noopener noreferrer" class="tag" style="text-decoration: none;">
        üîó –ò—Å—Ç–æ—á–Ω–∏–∫
      </a>
      {% endif %}
    </div>
    
    <img class="hero" 
         src='{{ url_for("static", filename="img/" + (article.get("topic_key","default")) + ".png") }}' 
         alt='{{ article.get("topic", "News") }}'
         loading="lazy"
         data-fallback='{{ url_for("static", filename="img/default.png") }}'>
    
    <div class="text">
      {{ article.get('text','')|replace('\n', '<br>')|safe }}
    </div>

    <button class="share-btn" onclick="shareArticle()">
      <span>üì§</span>
      <span>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</span>
    </button>
  </article>

  {% if recs %}
  <section style="margin-top: 64px;">
    <h3>üîó –ü–æ—Ö–æ–∂–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h3>
    <div class="grid">
      {% for r in recs %}
      <article class="card small" data-article-id="{{ r['id'] }}" style="cursor: pointer;">
        <a href="{{ url_for('article', article_id=r['id']) }}" onclick="event.stopPropagation();">
          <img src='{{ url_for("static", filename="img/" + (r["topic_key"]|default("default")) + ".png") }}'
               alt='{{ r.get("topic", "News") }}'
               loading="lazy"
               data-fallback='{{ url_for("static", filename="img/default.png") }}'>
        </a>
        <div class="meta">
          {% if r.get('topic') %}
          <span class="tag" data-topic="{{ r['topic'] }}" style="cursor: pointer;">
            {{ r['topic'] }}
          </span>
          {% endif %}
          {% if r.get('date') %}
          <span class="date">üìÖ {{ r['date'] }}</span>
          {% endif %}
          {% if r.get('score') %}
          <span class="score">‚ú® {{ '%.0f'|format(r['score'] * 100) }}%</span>
          {% endif %}
        </div>
        <h4>
          <a href="{{ url_for('article', article_id=r['id']) }}" onclick="event.stopPropagation();">
            {{ r['title'] }}{% if r['title']|length > 100 %}...{% endif %}
          </a>
        </h4>
      </article>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <script>
    function shareArticle() {
      const title = "{{ article.get('title','')|replace("'", "\\'") }}";
      const url = window.location.href;
      
      if (navigator.share) {
        navigator.share({
          title: title,
          url: url
        }).catch(err => console.log('Error sharing', err));
      } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(url).then(() => {
          alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
        }).catch(err => {
          // Fallback: show URL
          prompt('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É:', url);
        });
      }
    }
  </script>
{% endblock %}
