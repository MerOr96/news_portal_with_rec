{% extends 'base.html' %}
{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - News Portal{% endblock %}
{% block content %}
  <h2>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π</h2>

  {% if charts.get('topics') and charts['topics']|length > 0 %}
  <section style="margin-bottom: 48px;">
    <h3>üìà –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–µ–º–∞–º (—Ç–æ–ø-10)</h3>
    <ul class="bars">
      {% set total = charts['topics'].values()|sum %}
      {% set denom = total if total > 0 else 1 %}
      {% set max_val = charts['topics'].values()|max %}
      {% for k, v in charts['topics'].items() %}
      <li>
        <span class="label">{{ k }}</span>
        <span class="bar" style="width: {{ ((v / max_val) * 100)|round(1) }}%; min-width: 20px;" 
              title="{{ v }} —Å—Ç–∞—Ç–µ–π ({{ ((v / denom) * 100)|round(1) }}%)">
        </span>
        <span class="val">{{ v }}</span>
      </li>
      {% endfor %}
    </ul>
    <p style="color: var(--text-muted); font-size: 14px; margin-top: 16px;">
      –í—Å–µ–≥–æ —Å—Ç–∞—Ç–µ–π: <strong>{{ total }}</strong>
    </p>
  </section>
  {% else %}
  <section style="margin-bottom: 48px;">
    <h3>üìà –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–µ–º–∞–º</h3>
    <div class="empty-state">
      <p style="color: var(--text-muted);">–î–∞–Ω–Ω—ã—Ö –ø–æ —Ç–µ–º–∞–º –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    </div>
  </section>
  {% endif %}

  {% if charts.get('timeline') and charts['timeline']|length > 0 %}
  <section style="margin-bottom: 48px;">
    <h3>üìÖ –î–∏–Ω–∞–º–∏–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
    <div style="overflow-x: auto;">
      <table class="table">
        <thead>
          <tr>
            <th>–ú–µ—Å—è—Ü</th>
            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π</th>
            <th>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {% set max_timeline = charts['timeline'].values()|max %}
          {% for k, v in charts['timeline'].items()|sort %}
          <tr>
            <td><strong>{{ k }}</strong></td>
            <td>{{ v }}</td>
            <td>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div style="flex: 1; height: 20px; background: var(--bg-secondary); border-radius: 10px; overflow: hidden;">
                  <div style="height: 100%; width: {{ ((v / max_timeline) * 100)|round(1) }}%; background: var(--gradient-3); border-radius: 10px; transition: var(--transition);"></div>
                </div>
                <span style="color: var(--text-muted); font-size: 12px; min-width: 50px; text-align: right;">
                  {{ ((v / max_timeline) * 100)|round(0) }}%
                </span>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
  {% endif %}

  {% if charts.get('top_tags') and charts['top_tags']|length > 0 %}
  <section style="margin-bottom: 48px;">
    <h3>üè∑Ô∏è –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏</h3>
    <div class="tags-cloud">
      {% set max_tag = charts['top_tags'].values()|max %}
      {% for k, v in charts['top_tags'].items() %}
      <span class="tag" 
            style="font-size: {{ (12 + (v / max_tag) * 12)|round(0) }}px;"
            title="{{ v }} —É–ø–æ–º–∏–Ω–∞–Ω–∏–π">
        #{{ k }}
      </span>
      {% endfor %}
    </div>
    <p style="color: var(--text-muted); font-size: 14px; margin-top: 16px;">
      –í—Å–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–µ–≥–æ–≤: <strong>{{ charts['top_tags']|length }}</strong>
    </p>
  </section>
  {% endif %}

  <section style="margin-top: 48px; padding: 24px; background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border-color);">
    <h3 style="margin-top: 0;">‚ÑπÔ∏è –û –¥–∞–Ω–Ω—ã—Ö</h3>
    <p style="color: var(--text-secondary); line-height: 1.8;">
      –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã –Ω–æ–≤–æ—Å—Ç–µ–π. –ì—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π.
      –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ —Ç–µ–º–∞–º.
    </p>
  </section>
{% endblock %}
